<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายงานผลการตรวจสอบสาขา B103 U-Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js and plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <!-- Ionicons for icons -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f3f4f6;
        }
        .report-section {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        .report-header-title {
            background-color: #1f2937;
            color: white;
            padding: 1rem 1.5rem;
            font-size: 1.25rem;
            font-weight: 700;
        }
        .report-content {
            padding: 1.5rem;
        }
        .main-title {
            font-size: 2.25rem;
            line-height: 2.5rem;
            font-weight: 800;
            color: #111827;
            text-align: center;
            margin-bottom: 2rem;
        }
        .prose {
            max-width: none;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="w-full max-w-5xl mx-auto">
        
        <!-- Header Section -->
        <section class="report-section">
            <header class="bg-white flex items-center justify-center py-16 text-center">
                <div class="px-4">
                    <h1 class="main-title">รายงานผลการตรวจสอบสาขาและนับสต็อกสาขา B103 U-Store มหาวิทยาลัยเทคโนโลยีราชมงคลกรุงเทพ</h1>
                    <p class="text-lg text-gray-500">วันที่ตรวจสอบ: 23 มิถุนายน 2568</p>
                </div>
            </header>
        </section>

        <!-- Dashboard Section -->
        <section class="report-section">
            <h2 class="report-header-title">แดชบอร์ดติดตามผลการตรวจสอบ</h2>
            <div class="report-content space-y-8">
                
                <!-- Executive Summary -->
                <div class='bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg'>
                    <h2 class='text-xl font-bold text-blue-800 mb-2'>บทสรุปสำหรับผู้บริหาร</h2>
                    <p class='text-gray-700'>ทีม Operation Audit ได้ดำเนินการตรวจสอบตามแผนการตรวจสอบประจำไตรมาส 2 ปี 2568 ณ สาขา B103 U-Store เพื่อให้มั่นใจได้ว่าการปฏิบัติงานของสาขามีความถูกต้องตามแนวทางที่บริษัทฯ กำหนด และได้ดำเนินการตรวจสอบเสร็จสิ้นแล้ว จึงขอรายงานผลการตรวจสอบรูปแบบ On-site จากการเข้าตรวจสอบในวันที่ 23 มิถุนายน 2568 ซึ่งมีรายละเอียดที่เกี่ยวข้อง ดังนี้</p>
                </div>

                <!-- Metrics -->
                <div id='dashboard-metrics' class='grid grid-cols-2 md:grid-cols-4 gap-4'>
                    <!-- Metrics will be dynamically generated by JavaScript -->
                </div>
                
                <!-- Findings Table -->
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h2 class='text-xl font-semibold text-gray-700'>ตารางสรุปข้อตรวจพบที่ต้องดำเนินการ</h2>
                        <div class="flex items-center gap-4">
                             <div id="save-status" class="text-sm text-gray-500 flex items-center transition-opacity duration-300 opacity-0">
                                <ion-icon name="cloud-done-outline" class="mr-2 text-green-500"></ion-icon>
                                <span></span>
                            </div>
                            <button id="save-btn" class="px-5 py-2.5 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                                บันทึกการเปลี่ยนแปลง
                            </button>
                        </div>
                    </div>
                    <div class='overflow-x-auto rounded-lg border'>
                        <table class='w-full text-left text-sm'>
                            <thead class='bg-gray-100 border-b'>
                                <tr>
                                    <th class='px-4 py-3 font-semibold text-gray-600'>ลำดับ</th>
                                    <th class='px-4 py-3 font-semibold text-gray-600'>รายละเอียดข้อตรวจพบ</th>
                                    <th class='px-4 py-3 font-semibold text-gray-600'>ข้อเสนอแนะ</th>
                                    <th class='px-4 py-3 font-semibold text-gray-600'>ผู้รับผิดชอบ</th>
                                    <th class='px-4 py-3 font-semibold text-gray-600 text-center'>กำหนดแล้วเสร็จ</th>
                                    <th class='px-4 py-3 font-semibold text-gray-600 text-center'>สถานะ</th>
                                </tr>
                            </thead>
                            <tbody id="findings-table-body">
                                <!-- Table rows will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Detailed Findings Section -->
        <section class="report-section">
            <h2 class="report-header-title">รายละเอียดข้อตรวจพบสำคัญ</h2>
            <div class="report-content space-y-6">
                 <div class="border rounded-lg p-4 bg-white shadow-sm">
                    <p class="font-bold text-lg text-gray-800">1. พบ DEMO Security ไม่ทำงาน</p>
                    <p class="mt-1 text-sm text-gray-600">จากการสุ่มตรวจ พบ DEMO 1 รายการ ที่สาย Security ไม่ส่งเสียงแจ้งเตือนเมื่อถูกปลดขโมย</p>
                    <div class="mt-4 text-center text-sm text-gray-500">
                        <img src="https://placehold.co/600x400/e2e8f0/64748b?text=รูปภาพ+DEMO" alt="รูปภาพ DEMO Security" class="mx-auto rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/64748b?text=Image+Not+Found';">
                    </div>
                 </div>
                 <div class="border rounded-lg p-4 bg-white shadow-sm">
                    <p class="font-bold text-lg text-gray-800">2. พบสาขามีพนักงานดูแลเพียงคนเดียว</p>
                    <p class="mt-1 text-sm text-gray-600">สาขามีพนักงานประจำ 2 คน แต่ต้องผลัดเวียนไปช่วยสาขาอื่น ทำให้เหลือผู้ดูแลเพียงคนเดียว ซึ่งอาจไม่สามารถดูแลสินค้าได้ทั่วถึง โดยเฉพาะช่วงใกล้เปิดเทอม</p>
                     <div class="mt-4 text-center text-sm text-gray-500">
                        <img src="https://placehold.co/600x400/e2e8f0/64748b?text=รูปภาพ+Airpod+จุดเสี่ยง" alt="รูปภาพ Airpod จุดเสี่ยง" class="mx-auto rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/64748b?text=Image+Not+Found';">
                     </div>
                 </div>
                 <div class="border rounded-lg p-4 bg-white shadow-sm">
                    <p class="font-bold text-lg text-gray-800">3. สินค้าแขวนไม่เต็มช่อง</p>
                    <p class="mt-1 text-sm text-gray-600">พบช่องแขวนสินค้าขาย ไม่มีสินค้าแขวนหลายช่อง ควรพิจารณาเพิ่มสินค้าให้เต็มพื้นที่เพื่อโอกาสในการขาย</p>
                    <div class="mt-4 text-center text-sm text-gray-500">
                        <img src="https://placehold.co/600x400/e2e8f0/64748b?text=รูปภาพช่องแขวนสินค้า" alt="รูปภาพช่องแขวนสินค้า" class="mx-auto rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/64748b?text=Image+Not+Found';">
                    </div>
                 </div>
            </div>
        </section>

        <!-- Good Performance Section -->
        <section class="report-section">
            <h2 class="report-header-title">ส่วนงานที่ปฏิบัติได้ดี</h2>
            <div class="report-content grid md:grid-cols-3 gap-4 text-center">
                <div class="bg-green-50 border-t-4 border-green-500 p-4 rounded-lg shadow-sm">
                    <ion-icon name="document-text-outline" class="text-4xl text-green-600 mx-auto"></ion-icon>
                    <p class="font-semibold mt-2">เอกสารเบิกจ่าย</p>
                    <p class="text-xs text-gray-600">มีการเก็บหลักฐานครบถ้วนดี</p>
                </div>
                <div class="bg-green-50 border-t-4 border-green-500 p-4 rounded-lg shadow-sm">
                    <ion-icon name="file-tray-stacked-outline" class="text-4xl text-green-600 mx-auto"></ion-icon>
                    <p class="font-semibold mt-2">การจัดระเบียบสต็อก</p>
                    <p class="text-xs text-gray-600">ห้องสต็อกเป็นระเบียบเรียบร้อย</p>
                </div>
                <div class="bg-green-50 border-t-4 border-green-500 p-4 rounded-lg shadow-sm">
                    <ion-icon name="sparkles-outline" class="text-4xl text-green-600 mx-auto"></ion-icon>
                    <p class="font-semibold mt-2">ความสะอาด</p>
                    <p class="text-xs text-gray-600">พื้นที่หน้าร้านสะอาดเรียบร้อย</p>
                </div>
            </div>
        </section>
        
        <!-- Additional Details Section -->
         <section class="report-section">
            <h2 class="report-header-title">รายละเอียดการตรวจสอบ (เพิ่มเติม)</h2>
            <div class="report-content grid md:grid-cols-2 gap-8">
                <!-- Cash Control -->
                <div>
                    <h3 class="font-bold text-lg mb-4">1. การควบคุมเงินสด (Cash Control)</h3>
                    <div class="relative h-64"><canvas id="cashChart"></canvas></div>
                     <div class="bg-gray-50 rounded-lg p-3 mt-4 text-sm text-gray-700">
                         <ul class="list-disc list-inside space-y-1">
                            <li><strong>สถานะ:</strong> ปกติดี</li>
                            <li><strong>สรุป:</strong> สาขามีการใช้เงินสดเป็นไปตามระเบียบของบริษัทฯกำหนด</li>
                         </ul>
                     </div>
                </div>
                 <!-- Product Control -->
                 <div>
                    <h3 class="font-bold text-lg mb-4">2. การควบคุมสินค้า (Product Control)</h3>
                    <div class="relative h-64"><canvas id="productChart"></canvas></div>
                    <div class="bg-gray-50 rounded-lg p-3 mt-4 text-sm text-gray-700">
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>สถานะ:</strong> ปกติดี สินค้าครบถ้วน</li>
                            <li><strong>สินค้า Cosmetic:</strong> พบ 1 ชิ้น (สาขาเชียร์ขายต่อไป)</li>
                             <li><strong>สินค้าเคลม:</strong> มี 6 ชิ้น (พร้อมส่งเคลม)</li>
                            <li><strong>ข้อตรวจพบสำคัญ:</strong> พบ DEMO 1 รายการที่ Security ไม่ทำงาน</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "DEMO_KEY", authDomain: "DEMO.firebaseapp.com", projectId: "DEMO" };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-audit-app';

        // --- Firebase Initialization ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- State Management ---
        let findingsData = [];
        let firestoreDocRef;
        let unsubscribe; // To store the onSnapshot listener remover

        // --- Initial Data (used if Firestore document doesn't exist) ---
        const initialFindings = [
            { id: 1, finding: "ข้อบกพร่องด้านความปลอดภัย: สินค้า DEMO ไม่ส่งเสียงแจ้งเตือนเมื่อถูกปลดขโมย", suggestion: "ให้หัวหน้าชาแนลเร่งแก้ไขโดยเร่งด่วน เพื่อป้องกันสินค้าถูกขโมย", responsible: "หัวหน้าชาแนล", dueDate: "2025-06-30", status: "คงค้าง" },
            { id: 2, finding: "เจ้าหน้าที่สาขาไม่เพียงพอ: มีเจ้าหน้าที่ประจำการเพียง 1 คน", suggestion: "แนะนำให้หัวหน้าชาแนลประเมิน Traffic เพื่อเตรียมรับมือช่วงเปิดภาคเรียน และพิจารณาใช้กล่องเปล่าโชว์แทนสินค้าจริงในจุดเสี่ยง", responsible: "หัวหน้าชาแนล", dueDate: "", status: "คงค้าง" },
            { id: 3, finding: "สินค้าแขวนไม่เต็มช่องแขวนสินค้า", suggestion: "ให้พิจารณาขอเพิ่มสินค้าให้สามารถจัดแสดงในจุดแขวนได้ครบถ้วนเพียงพอ", responsible: "เจ้าหน้าที่, หัวหน้าชาแนล, PM", dueDate: "", status: "คงค้าง" }
        ];

        // --- UI Elements ---
        const saveBtn = document.getElementById('save-btn');
        const saveStatusEl = document.getElementById('save-status');

        // --- Authentication ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("User is authenticated:", user.uid);
                // Define the document reference for this specific report
                const reportId = 'b103_20250623';
                firestoreDocRef = doc(db, "artifacts", appId, "public", "data", "audit_reports", reportId);
                
                // Stop listening to old document if any
                if(unsubscribe) unsubscribe();

                // Start listening for real-time updates
                loadAndListenForUpdates();
            } else {
                console.log("User is not authenticated. Signing in...");
                 if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            }
        });

        // --- Firestore Data Handling ---
        function loadAndListenForUpdates() {
            if (!firestoreDocRef) return;

            unsubscribe = onSnapshot(firestoreDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    // Document exists, load the data
                    console.log("Document data loaded from Firestore.");
                    findingsData = docSnap.data().findings;
                } else {
                    // Document doesn't exist, create it with initial data
                    console.log("No such document! Creating with initial data.");
                    findingsData = JSON.parse(JSON.stringify(initialFindings));
                    saveChanges(true); // Save initial data without user interaction
                }
                // Render the UI with the latest data
                renderAll();
            }, (error) => {
                console.error("Error listening to document:", error);
            });
        }
        
        async function saveChanges(isInitialSave = false) {
            if (!firestoreDocRef) {
                console.error("Firestore document reference not set.");
                return;
            }
            if(!isInitialSave) {
                 saveBtn.disabled = true;
                 saveBtn.textContent = 'กำลังบันทึก...';
            }
           
            try {
                // Use setDoc with merge: true to avoid overwriting other fields if any
                await setDoc(firestoreDocRef, { findings: findingsData }, { merge: true });
                if(!isInitialSave) {
                    console.log("Changes saved to Firestore!");
                    showSaveStatus("บันทึกสำเร็จ!");
                }
            } catch (error) {
                console.error("Error saving changes to Firestore: ", error);
                 if(!isInitialSave) showSaveStatus("เกิดข้อผิดพลาด!");
            } finally {
                 if(!isInitialSave){
                    saveBtn.textContent = 'บันทึกการเปลี่ยนแปลง';
                    // The button will be re-enabled by the onSnapshot listener implicitly
                 }
            }
        }

        // --- Rendering Logic ---
        function renderAll() {
            renderTable();
            updateDashboardMetrics();
        }

        function renderTable() {
            const tableBody = document.getElementById('findings-table-body');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            findingsData.forEach(item => {
                const row = document.createElement('tr');
                let rowClass = 'bg-white hover:bg-gray-50 align-top';
                if(item.status === 'ดำเนินการแล้ว') {
                    rowClass = 'bg-green-50 hover:bg-green-100 text-gray-500 line-through align-top';
                }
                row.className = `border-b ${rowClass} transition-colors duration-300`;
                
                row.innerHTML = `
                    <td class="px-4 py-4 text-center">${item.id}</td>
                    <td class="px-4 py-4 font-semibold text-current">${item.finding}</td>
                    <td class="px-4 py-4 text-xs text-current">${item.suggestion}</td>
                    <td class="px-4 py-4 text-current">${item.responsible}</td>
                    <td class="px-4 py-4 text-center">
                        <input type="date" class="w-full p-1 border border-gray-300 rounded-md text-sm text-center date-input" value="${item.dueDate}" data-id="${item.id}">
                    </td>
                    <td class="px-4 py-3 text-center">
                        <select class="w-full p-1.5 border border-gray-300 rounded-md text-xs status-select" data-id="${item.id}">
                            <option value="คงค้าง" ${item.status === 'คงค้าง' ? 'selected' : ''}>คงค้าง</option>
                            <option value="ดำเนินการแล้ว" ${item.status === 'ดำเนินการแล้ว' ? 'selected' : ''}>ดำเนินการแล้ว</option>
                        </select>
                    </td>`;
                tableBody.appendChild(row);
            });
            attachTableEventListeners();
        }

        function attachTableEventListeners(){
            document.querySelectorAll('.date-input, .status-select').forEach(element => {
                element.onchange = (e) => {
                    const id = parseInt(e.target.dataset.id);
                    const key = e.target.classList.contains('date-input') ? 'dueDate' : 'status';
                    const value = e.target.value;
                    
                    const itemIndex = findingsData.findIndex(item => item.id === id);
                    if (itemIndex > -1) {
                        findingsData[itemIndex][key] = value;
                    }
                    saveBtn.disabled = false; // Enable save button on change
                    // Re-render immediately for better UX
                    renderTable();
                    updateDashboardMetrics();
                };
            });
        }
        
        saveBtn.addEventListener('click', () => saveChanges(false));


        function updateDashboardMetrics() {
            const total = findingsData.length;
            const completed = findingsData.filter(f => f.status === 'ดำเนินการแล้ว').length;
            const pending = total - completed;
            const overdue = findingsData.filter(f => f.dueDate && new Date(f.dueDate) < new Date() && f.status === 'คงค้าง').length;
            
            const metricsContainer = document.getElementById('dashboard-metrics');
            if(!metricsContainer) return;
            
            metricsContainer.innerHTML = `
                <div class='bg-gray-100 p-4 rounded-lg text-center'><h4 class='font-bold text-gray-600'>ข้อตรวจพบทั้งหมด</h4><p class='text-3xl font-bold text-gray-800'>${total}</p></div>
                <div class='bg-red-50 p-4 rounded-lg text-center'><h4 class='font-bold text-red-600'>คงค้าง</h4><p class='text-3xl font-bold text-red-800'>${pending}</p></div>
                <div class='bg-green-50 p-4 rounded-lg text-center'><h4 class='font-bold text-green-600'>ดำเนินการแล้ว</h4><p class='text-3xl font-bold text-green-800'>${completed}</p></div>
                <div class='bg-indigo-50 p-4 rounded-lg text-center'><h4 class='font-bold text-indigo-600'>เร่งด่วน</h4><p class='text-3xl font-bold text-indigo-800'>${overdue}</p></div>
            `;
        }
        
        function showSaveStatus(message) {
            const text = saveStatusEl.querySelector('span');
            text.textContent = message;
            saveStatusEl.style.opacity = '1';
            setTimeout(() => { saveStatusEl.style.opacity = '0'; }, 3000);
        }

        // --- Chart Initializations (Run once on DOMContentLoaded)---
        document.addEventListener('DOMContentLoaded', () => {
            Chart.register(window.ChartDataLabels);
            Chart.register(window['chartjs-plugin-annotation']);

            const cashCtx = document.getElementById('cashChart')?.getContext('2d');
            if (cashCtx) {
                const changeMoney = 2500;
                const pettyCashTotal = 3000;
                const pettyCashLimit = 3000;
                const changeMoneyLimit = 2500;

                new Chart(cashCtx, {
                    type: 'bar',
                    data: {
                        labels: ['เงินทอน', 'เงินสดย่อย'],
                        datasets: [{
                            data: [changeMoney, pettyCashTotal],
                            backgroundColor: ['rgba(59, 130, 246, 0.7)', 'rgba(251, 146, 60, 0.7)'],
                            borderColor: ['rgba(59, 130, 246, 1)', 'rgba(251, 146, 60, 1)'],
                            borderWidth: 1,
                            borderRadius: 5,
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            datalabels: {
                                anchor: 'end',
                                align: 'end',
                                formatter: (value) => new Intl.NumberFormat('th-TH').format(value),
                                color: '#374151',
                                font: { weight: 'bold' }
                            },
                            annotation: {
                                annotations: {
                                    pettyCashThreshold: {
                                        type: 'line',
                                        yMin: pettyCashLimit,
                                        yMax: pettyCashLimit,
                                        borderColor: 'rgba(251, 146, 60, 1)',
                                        borderWidth: 2,
                                        borderDash: [6, 6],
                                        label: {
                                            content: `วงเงินสดย่อย (${new Intl.NumberFormat('th-TH').format(pettyCashLimit)})`,
                                            display: true,
                                            position: 'end',
                                            backgroundColor: 'rgba(251, 146, 60, 0.8)'
                                        }
                                    },
                                    changeMoneyThreshold: {
                                        type: 'line',
                                        yMin: changeMoneyLimit,
                                        yMax: changeMoneyLimit,
                                        borderColor: 'rgba(59, 130, 246, 1)',
                                        borderWidth: 2,
                                        borderDash: [6, 6],
                                        label: {
                                            content: `วงเงินทอน (${new Intl.NumberFormat('th-TH').format(changeMoneyLimit)})`,
                                            display: true,
                                            position: 'start',
                                            backgroundColor: 'rgba(59, 130, 246, 0.8)'
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'จำนวนเงิน (บาท)' }
                            }
                        }
                    }
                });
            }

            const productCtx = document.getElementById('productChart')?.getContext('2d');
            if(productCtx) {
                const systemCount = 911;
                new Chart(productCtx, {
                    type: 'bar',
                    data: {
                        labels: ['สินค้าคงคลัง'],
                        datasets: [ { label: 'จำนวนที่ตรวจนับ', data: [911], backgroundColor: 'rgba(59, 130, 246, 0.7)', borderColor: 'rgba(59, 130, 246, 1)', borderWidth: 1, borderRadius: 5 } ]
                    },
                    options: {
                         responsive: true, maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            datalabels: { anchor: 'end', align: 'end', color: '#374151', font: { weight: 'bold' } },
                            annotation: { annotations: {
                                threshold1: { type: 'line', yMin: systemCount, yMax: systemCount, borderColor: 'rgba(16, 185, 129, 1)', borderWidth: 2, borderDash: [6, 6], label: { content: `จำนวนในระบบ (${systemCount})`, display: true, position: 'end', backgroundColor: 'rgba(16, 185, 129, 0.8)' } },
                            }}
                        },
                        scales: { y: { beginAtZero: true, title: { display: true, text: 'จำนวน (ชิ้น)'}} }
                    }
                });
            }
        });

    </script>
</body>
</html>
